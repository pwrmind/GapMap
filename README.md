# GapMap — Поиск «голубых океанов» в товарных нишах

## Описание
BlueOceanFinder — это инструмент на Python для семантического анализа рынка, который выявляет незанятые товарные ниши («голубые океаны») путём сравнения векторизованных данных о спросе (поисковые запросы) и предложении (существующие товары). Проект использует современные модели эмбеддингов и методы кластеризации для обнаружения перспективных направлений в e‑commerce.

## Функциональность
- Векторизация текстовых данных через Ollama API (модель `mxbai-embed-large`)
- Расчёт семантических расстояний между запросами и товарами на GPU (PyTorch)
- Вычисление индекса ниши на основе разрыва в семантике и популярности запроса
- Кластеризация перспективных запросов в товарные категории (HDBSCAN)
- Автоматическое определение устройство вычислений (CUDA/CPU)

## Установка и запуск

### 1. Требования
- Python 3.8+
- Установленный и запущенный Ollama (localhost:11434)
- Модель для эмбеддингов: `ollama pull mxbai-embed-large`

### 2. Установка зависимостей
```bash
pip install torch numpy pandas requests tqdm scikit-learn
```

### 3. Запуск примера
```bash
python main.py
```

## Использование
### Подготовка данных
- `queries_df` — DataFrame с колонками:
  - `query` — текст поискового запроса
  - `volume` — частотность запроса (целое число)
- `catalog_df` — DataFrame с колонкой:
  - `product_name` — название товара

### Пример кода
```python
finder = BlueOceanFinder()
scored_df, query_vectors = finder.find_gaps(queries_df, catalog_df)
niches_df = finder.cluster_niches(scored_df, query_vectors, threshold_percentile=40)
```

## Алгоритм работы
1. **Векторизация** — преобразование текстов запросов и товаров в векторные представления.
2. **Расчёт разрывов** — нахождение минимального евклидова расстояния между каждым запросом и всеми товарами.
3. **Индексирование ниш** — вычисление индекса ниши: `gap_score * log(volume + 1)`.
4. **Кластеризация** — группировка запросов с высоким индексом в семантические кластеры (ниши).

## Пример вывода
```
==================================================
АНАЛИЗ 'ГОЛУБЫХ ОКЕАНОВ' (TOP NICHES 2026)
==================================================

Ниша (Кластер #0):
 - термос для еды с подогревом от usb (Индекс: 12.45)
 - складная беговая дорожка под кровать (Индекс: 11.87)
```

## Технические особенности
- Поддержка батчинга для экономии памяти GPU
- Обработка ошибок при запросах к Ollama API
- Автоматическая очистка кэша видеопамяти
- Настройка порога отбора ниш через процентили

## Лицензия
Проект распространяется под лицензией MIT.